'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _utils=require('./utils'),_result=require('./result'),_result2=_interopRequireDefault(_result);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}const Task=class{constructor(a,b,c,d,e){this.api=a,this.fromFormat=b,this.toFormat=c,this.conversionTimeout=e||a.conversionTimeout,this.params=d,this.defaultParams={StoreFile:!0}}run(){var a=this;return _asyncToGenerator(function*(){let b;const c=yield a.normalizeParams(a.params);a.conversionTimeout&&(c.Timeout=a.conversionTimeout,b=a.conversionTimeout+a.api.conversionTimeoutDelta);const d=a.fromFormat||(0,_utils.detectFormat)(c),e=c.converter?`/converter/${c.converter}`:'',f=`convert/${d}/to/${a.toFormat}${e}`,g=yield a.api.client.post(f,c,b);return new _result2.default(a.api,g)})()}normalizeParams(a){var b=this;return _asyncToGenerator(function*(){const c=Object.assign({},a,b.defaultParams);if(a.File){const d=yield a.File;c.File=yield(0,_utils.buildFileParam)(b.api,d)}if(a.Files){const d=yield(0,_utils.normalizeFilesParam)(a.Files),e=d.map(function(a){return(0,_utils.buildFileParam)(b.api,a)});c.Files=yield Promise.all(e)}return c})()}};exports.default=Task,module.exports=exports['default'];